<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rodent Health – Notes (Teams-like)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f5f7;
      --surface: #ffffff;
      --surface-alt: #f3f4f6;
      --border: #e5e7eb;
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #b91c1c;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.05);
      --input-bg: #f9fafb;
      --input-border: #d1d5db;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top left, #e5f0ff, #f9fafb 55%);
      color: var(--text-main);
    }

    .app-shell {
      max-width: 900px;
      margin: 0 auto;
    }

    .page-header {
      margin-bottom: 16px;
    }

    .page-title {
      font-size: 1.4rem;
      font-weight: 650;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 500;
    }

    .page-subtitle {
      font-size: 0.86rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .section {
      border-radius: var(--radius-lg);
      padding: 16px 16px 14px;
      background: linear-gradient(
        135deg,
        rgba(248, 250, 252, 0.95),
        rgba(243, 244, 246, 0.9)
      );
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    .section-title {
      font-size: 0.98rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      letter-spacing: -0.01em;
    }

    .section-title span.icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: var(--primary);
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
    }

    .section-helper {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Notes layout */
    .notes-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(260px, 1fr);
      gap: 16px;
      margin-top: 8px;
    }

    @media (max-width: 800px) {
      .notes-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* Thread / timeline */
    .notes-thread {
      max-height: 380px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .note-item {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 8px;
      padding: 6px 4px;
      border-radius: 10px;
    }

    .note-item:hover {
      background: rgba(243, 244, 246, 0.9);
    }

    .note-avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.78rem;
      font-weight: 600;
      color: #4b5563;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .note-bubble {
      border-radius: 10px;
      padding: 6px 8px 6px;
      background: white;
      border: 1px solid #e5e7eb;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .note-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 4px 8px;
      align-items: center;
    }

    .note-author {
      font-weight: 600;
      color: #111827;
    }

    .note-timestamp {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .note-type-pill {
      border-radius: 999px;
      padding: 1px 7px;
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .note-type-initial {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .note-type-recheck {
      background: #dcfce7;
      color: #166534;
    }

    .note-type-followup {
      background: #fef3c7;
      color: #92400e;
    }

    .note-type-other {
      background: #e5e7eb;
      color: #374151;
    }

    .note-edited-flag {
      font-size: 0.7rem;
      color: #6b7280;
      font-style: italic;
    }

    .note-actions {
      display: flex;
      gap: 6px;
      font-size: 0.72rem;
    }

    .note-actions button {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 2px 6px;
      background: transparent;
      color: #6b7280;
      cursor: pointer;
    }

    .note-actions button:hover {
      background: #f3f4f6;
      border-color: #e5e7eb;
      color: #111827;
    }

    .note-body {
      white-space: pre-wrap;
      font-size: 0.78rem;
      color: #111827;
    }

    .note-body-edit textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--input-border);
      padding: 6px 7px;
      font-size: 0.78rem;
      background: var(--input-bg);
      resize: vertical;
      min-height: 60px;
      font-family: inherit;
    }

    /* New note composer */
    .notes-composer {
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.96);
      border: 1px solid #e5e7eb;
      padding: 10px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .composer-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .composer-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      min-width: 70px;
    }

    select,
    textarea,
    input[type="text"] {
      border-radius: var(--radius-md);
      border: 1px solid var(--input-border);
      padding: 6px 8px;
      font-size: 0.8rem;
      background: var(--input-bg);
      font-family: inherit;
    }

    select:focus,
    textarea:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
      background: #ffffff;
    }

    .composer-type-select {
      min-width: 150px;
    }

    .composer-textarea {
      width: 100%;
      min-height: 80px;
      resize: vertical;
    }

    .composer-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 2px;
      flex-wrap: wrap;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid transparent;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .helper-text {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="page-header">
      <div class="page-title">
        Rodent Health – Notes
        <span class="pill">Teams-like threaded notes</span>
      </div>
      <div class="page-subtitle">
        Notes support initial assessments and rechecks/follow-ups. All entries
        record user, date, time, and are editable by any user.
      </div>
    </header>

    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <span class="icon">N</span>
          Notes (Assessment &amp; Recheck History)
        </div>
        <div class="section-helper">
          Threaded, case-level notes with timestamps and editable entries.
        </div>
      </div>

      <div class="notes-layout">
        <!-- LEFT: Thread -->
        <div>
          <div id="notesThread" class="notes-thread">
            <!-- Notes injected by JS -->
          </div>
          <div class="helper-text">
            Entries are stored at the case level (not per recheck row). Sorting
            is newest-first or newest-last depending on final decision.
          </div>
        </div>

        <!-- RIGHT: New note composer / summary -->
        <div class="notes-composer">
          <div class="composer-row">
            <div class="composer-label">Entry type</div>
            <select id="noteType" class="composer-type-select">
              <option value="initial">Initial assessment</option>
              <option value="recheck">Recheck</option>
              <option value="followup">Follow-up</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="composer-row" style="align-items:flex-start;">
            <div class="composer-label" style="margin-top:4px;">Note</div>
            <textarea
              id="noteText"
              class="composer-textarea"
              placeholder="Enter assessment or follow-up details..."
            ></textarea>
          </div>

          <div class="composer-footer">
            <span>Logged in as <strong>Doe, Jane (Vet Tech)</strong></span>
            <button class="btn-primary" type="button" id="btnAddNote">
              Add note
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Mock logged-in user (in real app, pulled from auth/session)
    const CURRENT_USER = "Doe, Jane (Vet Tech)";

    // In-memory notes list for this mock (would be case-level in DB)
    let notes = [];

    // Utility: format timestamps like "11-20-2025 09:32"
    function formatDateTime(dt) {
      const mm = String(dt.getMonth() + 1).padStart(2, "0");
      const dd = String(dt.getDate()).padStart(2, "0");
      const yyyy = dt.getFullYear();
      const hh = String(dt.getHours()).padStart(2, "0");
      const min = String(dt.getMinutes()).padStart(2, "0");
      return `${mm}-${dd}-${yyyy} ${hh}:${min}`;
    }

    function getTypeLabelAndClass(type) {
      switch (type) {
        case "initial":
          return { label: "Initial assessment", cls: "note-type-initial" };
        case "recheck":
          return { label: "Recheck", cls: "note-type-recheck" };
        case "followup":
          return { label: "Follow-up", cls: "note-type-followup" };
        default:
          return { label: "Other", cls: "note-type-other" };
      }
    }

    // Render the full thread
    function renderNotes() {
      const container = document.getElementById("notesThread");
      container.innerHTML = "";

      if (notes.length === 0) {
        const empty = document.createElement("div");
        empty.className = "helper-text";
        empty.style.padding = "4px 0 6px";
        empty.textContent = "No notes yet. Use the panel on the right to add the first entry.";
        container.appendChild(empty);
        return;
      }

      // Sort oldest -> newest for a chat-style flow; flip if you prefer newest on top
      const sorted = [...notes].sort(
        (a, b) => a.createdAt.getTime() - b.createdAt.getTime()
      );

      sorted.forEach((note) => {
        const item = document.createElement("div");
        item.className = "note-item";
        item.dataset.id = note.id;

        // Avatar (initials)
        const avatar = document.createElement("div");
        avatar.className = "note-avatar";
        const initials = note.author
          .split(" ")
          .map((p) => p[0])
          .join("")
          .slice(0, 2)
          .toUpperCase();
        avatar.textContent = initials || "?";

        // Bubble
        const bubble = document.createElement("div");
        bubble.className = "note-bubble";

        // Header
        const header = document.createElement("div");
        header.className = "note-header";

        const metaLeft = document.createElement("div");
        metaLeft.className = "note-meta";

        const author = document.createElement("span");
        author.className = "note-author";
        author.textContent = note.author;

        const ts = document.createElement("span");
        ts.className = "note-timestamp";
        ts.textContent = formatDateTime(note.createdAt);

        const { label: typeLabel, cls: typeClass } = getTypeLabelAndClass(
          note.type
        );
        const typePill = document.createElement("span");
        typePill.className = `note-type-pill ${typeClass}`;
        typePill.textContent = typeLabel;

        metaLeft.appendChild(author);
        metaLeft.appendChild(ts);
        metaLeft.appendChild(typePill);

        if (note.edited) {
          const editedSpan = document.createElement("span");
          editedSpan.className = "note-edited-flag";
          editedSpan.textContent = "(edited)";
          metaLeft.appendChild(editedSpan);
        }

        const actions = document.createElement("div");
        actions.className = "note-actions";

        const editBtn = document.createElement("button");
        editBtn.type = "button";
        editBtn.textContent = "Edit";
        editBtn.addEventListener("click", () => enterEditMode(note.id));

        actions.appendChild(editBtn);

        header.appendChild(metaLeft);
        header.appendChild(actions);

        // Body
        const body = document.createElement("div");
        body.className = "note-body";
        body.textContent = note.text;

        bubble.appendChild(header);
        bubble.appendChild(body);

        item.appendChild(avatar);
        item.appendChild(bubble);

        container.appendChild(item);
      });

      // Scroll to bottom like Teams/Teams chat
      container.scrollTop = container.scrollHeight;
    }

    // Enter inline edit mode for a given note
    function enterEditMode(noteId) {
      const container = document.getElementById("notesThread");
      const item = container.querySelector(`.note-item[data-id="${noteId}"]`);
      if (!item) return;

      const note = notes.find((n) => n.id === noteId);
      if (!note) return;

      const bubble = item.querySelector(".note-bubble");
      const body = item.querySelector(".note-body");
      const actions = item.querySelector(".note-actions");

      // Replace body with textarea
      const editWrapper = document.createElement("div");
      editWrapper.className = "note-body-edit";
      const textarea = document.createElement("textarea");
      textarea.value = note.text;
      editWrapper.appendChild(textarea);

      bubble.replaceChild(editWrapper, body);

      // Replace actions with Save/Cancel
      actions.innerHTML = "";
      const saveBtn = document.createElement("button");
      saveBtn.type = "button";
      saveBtn.textContent = "Save";
      saveBtn.addEventListener("click", () => {
        const newText = textarea.value.trim();
        if (!newText) {
          alert("Note text cannot be empty.");
          return;
        }
        note.text = newText;
        note.edited = true;
        note.editedAt = new Date();
        renderNotes();
      });

      const cancelBtn = document.createElement("button");
      cancelBtn.type = "button";
      cancelBtn.textContent = "Cancel";
      cancelBtn.addEventListener("click", () => {
        renderNotes();
      });

      actions.appendChild(saveBtn);
      actions.appendChild(cancelBtn);

      textarea.focus();
    }

    // Add a new note from composer
    function addNoteFromComposer() {
      const typeSelect = document.getElementById("noteType");
      const textArea = document.getElementById("noteText");
      const type = typeSelect.value || "initial";
      const text = textArea.value.trim();

      if (!text) {
        alert("Please enter note text.");
        return;
      }

      const now = new Date();
      const note = {
        id: "note_" + now.getTime() + "_" + Math.floor(Math.random() * 1000),
        author: CURRENT_USER,
        type,
        text,
        createdAt: now,
        edited: false,
        editedAt: null,
      };

      notes.push(note);
      textArea.value = "";
      renderNotes();
    }

    // Seed a couple of example entries for visual context
    function seedSampleNotes() {
      const now = new Date();
      const earlier = new Date(now.getTime() - 60 * 60 * 1000);
      const muchEarlier = new Date(now.getTime() - 3 * 60 * 60 * 1000);

      notes = [
        {
          id: "note1",
          author: "Doe, Jane (Vet Tech)",
          type: "initial",
          text: "Initial assessment: Thin/hunched, rough coat. Cage moved to BLDG A / Room 101. Recheck in 24 hours.",
          createdAt: muchEarlier,
          edited: false,
          editedAt: null,
        },
        {
          id: "note2",
          author: "Doe, Jane (Vet Tech)",
          type: "recheck",
          text: "Recheck: Eating and drinking. Still mildly hunched, no new lesions observed.",
          createdAt: earlier,
          edited: true,
          editedAt: earlier,
        },
      ];
    }

    document.addEventListener("DOMContentLoaded", () => {
      seedSampleNotes();
      renderNotes();

      document
        .getElementById("btnAddNote")
        .addEventListener("click", addNoteFromComposer);
    });
  </script>
</body>
</html>
